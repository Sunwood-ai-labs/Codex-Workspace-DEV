name: Document Quality Check (Codex)

on:
  push:
    paths:
      - '**.md'
  pull_request:
    paths:
      - '**.md'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  check-docs:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install OpenAI Codex
        run: |
          npm install -g @openai/codex
        
      - name: Check documentation quality with Codex
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          CODEX_QUIET_MODE: "1"
        run: |
          # Codex„Çí‰Ωø„Å£„Å¶„Éâ„Ç≠„É•„É°„É≥„Éà„ÅÆÂìÅË≥™„Çí„ÉÅ„Çß„ÉÉ„ÇØ
          codex -a auto-edit  --quiet  "$(cat << 'EOF'
          „É™„Éù„Ç∏„Éà„É™„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          
          ‰ª•‰∏ã„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà„Å´Âæì„Å£„Å¶Á¢∫Ë™ç„Åó„ÄÅÂøÖË¶Å„Å´Âøú„Åò„Å¶‰øÆÊ≠£„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
          
          1. README.md„ÅÆÁ¢∫Ë™ç
             - „Çø„Ç§„Éà„É´„ÅØ‰∏≠Â§ÆÊèÉ„Åà„Åã
             - „Éò„ÉÉ„ÉÄ„ÉºÁîªÂÉè„ÅØ‰∏≠Â§ÆÊèÉ„Åà„Åã
             - ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ„ÅÆ„Éê„ÉÉ„Ç∏„ÅØÈÅ©Âàá„Å´ÈÖçÁΩÆ„Åï„Çå„ÄÅ‰∏≠Â§ÆÊèÉ„Åà„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åã
             - ÁµµÊñáÂ≠ó„ÇíÊ¥ªÁî®„Åó„Å¶ÂèØË™≠ÊÄß„ÅåÂêë‰∏ä„Åó„Å¶„ÅÑ„Çã„Åã
             - „Ç§„É≥„Çπ„Éà„Éº„É´ÊâãÈ†Ü„ÅåÊòéÁ¢∫„Åã
             - ‰ΩøÁî®ÊñπÊ≥ï„ÅåÊòéÁ¢∫„Åã
          
          2. „Éâ„Ç≠„É•„É°„É≥„Éà„ÅÆÈöéÂ±§ÊßãÈÄ†
             - ÂêÑÈöéÂ±§„Å´ÈÅ©Âàá„Å™README.md„Åå„ÅÇ„Çã„Åã
             - ÈáçË§á„Åå„Å™„ÅÑ„Åã
             - ÈÅ©Âàá„Å´„É™„É≥„ÇØ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åã
          
          3. Áí∞Â¢ÉÂ§âÊï∞
             - .env.example„Éï„Ç°„Ç§„É´„ÅåÂ≠òÂú®„Åô„Çã„Åã
             - ÂøÖË¶Å„Å™Áí∞Â¢ÉÂ§âÊï∞„Åå„Åô„Åπ„Å¶Ë®òËºâ„Åï„Çå„Å¶„ÅÑ„Çã„Åã
          
          ÂïèÈ°å„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØËá™ÂãïÁöÑ„Å´‰øÆÊ≠£„Åó„ÄÅÊñ∞„Åó„ÅÑ„Éñ„É©„É≥„ÉÅ„Çí‰ΩúÊàê„Åó„Å¶„Éó„É´„É™„ÇØ„Ç®„Çπ„Éà„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          
          ÈáçË¶Å: GitHub„ÅÆ„Éà„Éº„ÇØ„É≥„ÅØÁí∞Â¢ÉÂ§âÊï∞ GITHUB_TOKEN „ÅßÂà©Áî®ÂèØËÉΩ„Åß„Åô„ÄÇ
          EOF
          )"
      
      - name: Commit and push changes (if any)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          if [[ -n $(git status -s) ]]; then
            BRANCH_NAME="docs/quality-improvement-$(date +%Y%m%d-%H%M%S)"
            git checkout -b $BRANCH_NAME
            git add .
            git commit -m "ü´ê docs: „Éâ„Ç≠„É•„É°„É≥„ÉàÂìÅË≥™„ÅÆËá™ÂãïÊîπÂñÑ"
            git push origin $BRANCH_NAME
            
            # „Éó„É´„É™„ÇØ„Ç®„Çπ„Éà„ÅÆ„Ç≥„É°„É≥„Éà„Çí‰ΩúÊàê
            gh pr create --title "ü´ê docs: „Éâ„Ç≠„É•„É°„É≥„ÉàÂìÅË≥™„ÅÆËá™ÂãïÊîπÂñÑ" \
                         --body "Codex„Å´„Çà„Çã„Éâ„Ç≠„É•„É°„É≥„ÉàÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂÆüË°å„Åó„ÄÅ„ÅÑ„Åè„Å§„Åã„ÅÆÊîπÂñÑ„ÇíË°å„ÅÑ„Åæ„Åó„Åü„ÄÇ" \
                         --base main \
                         --head $BRANCH_NAME
          fi
